<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Localization system and mapping &mdash; BFMC - Competition Documentation  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="canonical" href="https://boschfuturemobility.com/data/vehicletoeverything/localizationsysandmap.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Semaphore" href="semaphore.html" />
    <link rel="prev" title="V2X - Vehicle to everything" href="../vehicletoeverything.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> BFMC - Competition Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../connectiondiagram.html">Connection diagram and components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../connectiondiagram/components.html">Components list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connectiondiagram/printedcomponents.html">Printed components - 3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../connectiondiagram/powerboard.html">Powerboard</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../racetrack.html">Race track</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../racetrack/groundmarkings.html">Ground markings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../racetrack/trafficsigns.html">Traffic signs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../racetrack/otherelements.html">Other elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../racetrack/positioning.html">Positioning on track</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../vehicletoeverything.html">V2X - Vehicle to everything</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Localization system and mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="semaphore.html">Semaphore</a></li>
<li class="toctree-l2"><a class="reference internal" href="livetraffic.html">Live traffic system</a></li>
<li class="toctree-l2"><a class="reference internal" href="vehicletovehicle.html">V2V - Vehicle to vehicle communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../embeddedplatform.html">Embedded platform</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../embeddedplatform/toolsfordevelopment.html">Tools for development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../embeddedplatform/debugging.html">Debugging the code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../brain.html">Brain project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../brain/pythonmultiprocessing.html">Python and multiprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../brain/rosversion.html">ROS setup and packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../brain/roswithsimulator.html">ROS with simulator data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../computer.html">Computer projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../computer/setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computer/testing.html">Simulated servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computer/demo.html">Demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../computer/dashboard.html">Dashboard</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulator.html">Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful.html">Useful</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../useful/usageraspberryclassic.html">Usage of rasbery pi - Classical approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful/usageRaspberryFast.html">Usage of rasbery pi - Fast approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful/ROS.html">Robot Operating System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful/coding.html">Coding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful/hardwareimprovements.html">Hardware improvements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful/materials.html">Aditional materials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../periodicstatus.html">Periodic status and examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BFMC - Competition Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../vehicletoeverything.html">V2X - Vehicle to everything</a></li>
      <li class="breadcrumb-item active">Localization system and mapping</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ECC-BFMC/Documentation/blob/master/source/data/vehicletoeverything/localizationsysandmap.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="localization-system-and-mapping">
<h1>Localization system and mapping<a class="headerlink" href="#localization-system-and-mapping" title="Permalink to this heading"></a></h1>
<p>An indoor localization system is available. It aims to detect and send upon connection the relative position for each robot on the race track. The localization
system is based on ROS2 in combination with a series of UWB devices. It has four main components: server, robot client(cars) and anchor device and tag device.
The anchors are set into know positions on the track. The tag devices, communicate with the anchors in order to get their position on the map; then the tags connect
to the server and sends in the location data. The server collects and stores the data from the tag devices (location on map) and waits for connections from the
robot clients; then, upon connection, it serves the desired data to the clients. Down below a picture describing the process.</p>
<a class="reference internal image-reference" href="../../_images/Localisation_system.png"><img alt="../../_images/Localisation_system.png" class="align-center" src="../../_images/Localisation_system.png" style="width: 935.4px; height: 423.0px;" /></a>
<p>The system will be installed only at the phisical competition. It is made of two components: one fixed component that will be glued to the car body upon arrival
and the actual device, which the team will get only while on the track. The active part will have displayed the ID of the connection. In the following image you
can see the place where the device will be placed, the fixed component and the actual device.</p>
<a class="reference internal image-reference" href="../../_images/Localisation_system_HW.png"><img alt="../../_images/Localisation_system_HW.png" class="align-center" src="../../_images/Localisation_system_HW.png" style="width: 2140.7999999999997px; height: 1020.0px;" /></a>
<dl class="simple">
<dt>The device weights 280 grams and the mandatory position for the device is the one in the picture. The design can be found here:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/3DModels/Locsys_Bottom.STL">Bottom</a></p></li>
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/3DModels/Locsys_Box.STL">Box</a></p></li>
<li><p><cite>Top</cite></p></li>
</ul>
</dd>
<dt>Technical data of the system:</dt><dd><ul class="simple">
<li><p>The frequency of the given messages is 5-10 Hz</p></li>
<li><p>The error of the system is of maximum 15 cm radius</p></li>
<li><p>The delay of the received messages is ~1 second</p></li>
</ul>
</dd>
</dl>
<p>A digital map is provided in order to help the teams navigate in the environment. The map is saved in XML format and it is exported with the help of the GraphML
library (making it easier to be imported on your platform). There are two types of information: Nodes and Connections. Each node is placed in the middle o a lane
and the distance between 2 nodes(on the same lane) will be roughly ~30 cm, with some variations. A connection describes the relations between twp nodes (dotted
or continuous line). Here you can see a straight road visual example:</p>
<a class="reference internal image-reference" href="../../_images/StraighRoadExample.PNG"><img alt="../../_images/StraighRoadExample.PNG" class="align-center" src="../../_images/StraighRoadExample.PNG" style="width: 492.0px; height: 122.39999999999999px;" /></a>
<p>Every node has 3 attributes: Id, X coordinate, Y coordinate. On the connectivity table instead, we have the start node id, the end node id and the type of
connection (straight or dotted road: TRUE or FALSE).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>Nodes table</p></th>
<th class="head" colspan="3"><p>Connections table</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>X</p></td>
<td><p>Y</p></td>
<td><p>Id_1</p></td>
<td><p>Id_2</p></td>
<td><p>Dotted</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>3.6</p></td>
<td><p>2.4</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>TRUE</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>4.0</p></td>
<td><p>2.4</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>4.4</p></td>
<td><p>2.4</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>FALSE</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>4.8</p></td>
<td><p>2.4</p></td>
<td colspan="3"></td>
</tr>
</tbody>
</table>
<p>In the intersections case, there will be 3 points with the same coordinates for a 3 roads intersection(A1, A2, A3) and 4 points for a 4 roads intersection(A1,
A2, A3, A4). This symbolization is done so to simulate a layered highway intersection, and so, helping you plan the path without taking into consideration U
turn cases inside the intersection (if we only have a single point connected to all the nodes, then a turn like 18-A-17 would be possible). The representation
is done in the following images.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><img alt="../../_images/3roadsExample.PNG" src="../../_images/3roadsExample.PNG" />
</td>
<td><img alt="../../_images/4roadsExample.PNG" src="../../_images/4roadsExample.PNG" />
</td>
</tr>
</tbody>
</table>
<dl>
<dt>You can find the figure and the digital representation on the following links:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/images/Test_track.png">Test track figure</a></p></li>
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/templates/Test_track.graphml">Test track digital</a></p></li>
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/images/Competition_track.png">Competition track figure</a></p></li>
<li><p><a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/templates/Competition_track.graphml">Competition track digital</a></p></li>
</ul>
<blockquote>
<div><p>The coordinates systems of the maps can be found here:
- <a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/templates/Track_Test.png">Test track coordinate system</a>
- <a class="reference external" href="https://github.com/ECC-BFMC/Documentation/blob/master/source/templates/Track.png">Competition track coordinate system</a></p>
<blockquote>
<div></div></blockquote>
</div></blockquote>
</dd>
</dl>
<section id="to-run">
<h2>To run<a class="headerlink" href="#to-run" title="Permalink to this heading"></a></h2>
<p>The API is listening for the server on the LAN. It validates the server and then connects to it with the car given ID. The server then returns the position of the
car on the map. It uses the src/data/gpstracker/gpstracker.py. script to intercept all the data.</p>
<p>The simulated server can be found here: test/gpsstrackerSERVER/gps.py.</p>
<ul class="simple">
<li><p>For testing purposes, publickey_server_test.pem should be used (file src/data/gpstracker/server_subscriber.py line 55)</p></li>
<li><p>For the competition, publickey_server.pem should be used (file test/gpstracker/server_subscriber.py line 54)</p></li>
</ul>
</section>
<section id="localisation-system">
<h2>Localisation system<a class="headerlink" href="#localisation-system" title="Permalink to this heading"></a></h2>
<p>localisationsystem is a module designed to get the position and orientation of the car itself on the map from the Localization System server.
The server streams it’s TCP port on the broadcast port (12345). The client then tries to connect to the server on the communicated TCP port, by sending it’s
own ID. The server replies with a plain and an encrypted message with it’s own private key. The client decrypts the encrypted message with the server public
key and checks that the messages are the same. If the messages are the same, the server is validated by the client and the connection is initiated.
The server then serves the client with it’s position and orientation on the map.</p>
<p>This simulates the real life GPS.</p>
<p>The information can be used in order to validate the position on the track at each moment, making the car independent to a starting point.</p>
<p>More details on the connection itself can be found in the src/data/localisationsystem/server_subscriber.py</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../vehicletoeverything.html" class="btn btn-neutral float-left" title="V2X - Vehicle to everything" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="semaphore.html" class="btn btn-neutral float-right" title="Semaphore" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Bosch Engineering Center Cluj and BFMC organizers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>